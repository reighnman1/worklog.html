<!DOCTYPE html>
<html>
<head>
    <title>Work Log Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 15px; background: #f0f2f5; }
        .card { max-width: 450px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        button { width: 100%; padding: 15px; margin: 8px 0; font-size: 1.1rem; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .in { background: #27ae60; color: white; }
        .out { background: #c0392b; color: white; }
        .edit { background: #f39c12; color: white; }
        #map-container { margin: 15px 0; display: none; border: 2px solid #ddd; border-radius: 8px; overflow: hidden; }
        #status { font-style: italic; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="card">
    <h2>Worker Portal</h2>
    
    <button class="in" onclick="handleLog('Clock IN')">CLOCK IN</button>
    <button class="out" onclick="handleLog('Clock OUT')">CLOCK OUT</button>
    <button class="edit" onclick="manualCorrection()">CORRECT LOG</button>

    <div id="map-container">
        <iframe id="map-frame" width="100%" height="200" frameborder="0" style="border:0"></iframe>
    </div>

    <p id="status">Waiting for action...</p>
</div>

<script>
    const RECIPIENTS = "efran1963@gmail.com,cfran92work@gmail.com,grayspacerentals@gmail.com,fourth-email@gmail.com";

    function handleLog(action, manualTime = null) {
        const name = prompt("Enter your Full Name:");
        if (!name) return;

        document.getElementById('status').innerText = "Capturing Location...";

        navigator.geolocation.getCurrentPosition((pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const time = manualTime ? manualTime : new Date().toLocaleString();
            
            // Show Map Preview
            const mapContainer = document.getElementById('map-container');
            const mapFrame = document.getElementById('map-frame');
            mapFrame.src = `https://maps.google.com/maps?q=${lat},${lon}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
            mapContainer.style.display = "block";

            // Prepare Email
            const subject = `${action}: ${name}`;
            const bodyText = `${name} has ${action.toLowerCase()} at ${time}.\n\nCoordinates: ${lat}, ${lon}\nGoogle Maps: https://www.google.com/maps?q=${lat},${lon}`;
            
            document.getElementById('status').innerText = "Ready to send!";
            
            // Open Email after a short delay so they see the map
            setTimeout(() => {
                window.location.href = `mailto:${RECIPIENTS}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(bodyText)}`;
            }, 1500);

        }, (err) => {
            alert("Location error. Ensure GPS is ON.");
        }, { enableHighAccuracy: true });
    }

    function manualCorrection() {
        const action = prompt("Is this a Correction for IN or OUT?");
        const date = prompt("Enter Date (DD/MM/YYYY):");
        const time = prompt("Enter Time (e.g. 08:30 AM):");
        
        if (date && time) {
            const correctionData = `CORRECTION: ${date} at ${time}`;
            handleLog(`MANUAL ${action}`, correctionData);
        }
    }
</script>

</body>
</html>
